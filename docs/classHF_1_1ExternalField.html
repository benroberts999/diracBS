<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ampsci: HF::ExternalField</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ampsci
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceHF.html">HF</a></li><li class="navelem"><a class="el" href="classHF_1_1ExternalField.html">ExternalField</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classHF_1_1ExternalField-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">HF::ExternalField</div>  </div>
</div><!--header-->
<div class="contents">

<p>Uses time-dependent Hartree-Fock method to include core-polarisation (RPA) corrections to matrix elements of some external field operator.  
 <a href="classHF_1_1ExternalField.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="ExternalField_8hpp_source.html">ExternalField.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac65a897695f44f9696a8ac5f56f21cbf"><td class="memItemLeft" align="right" valign="top"><a id="ac65a897695f44f9696a8ac5f56f21cbf"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>ExternalField</b> (const <a class="el" href="classDiracOperator_1_1TensorOperator.html">DiracOperator::TensorOperator</a> *const h, const <a class="el" href="classHF_1_1HartreeFock.html">HF::HartreeFock</a> *const hf)</td></tr>
<tr class="separator:ac65a897695f44f9696a8ac5f56f21cbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55b91b451132ca79e049b8ec6f88dc42"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#a55b91b451132ca79e049b8ec6f88dc42">solve_TDHFcore</a> (const double omega, int max_its=100, const bool <a class="el" href="classHF_1_1ExternalField.html#ade8eb069a969275416080445b4a24662">print</a>=true)</td></tr>
<tr class="memdesc:a55b91b451132ca79e049b8ec6f88dc42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Solves TDHF equations self-consistantly for core electrons at frequency omega.  <a href="#a55b91b451132ca79e049b8ec6f88dc42">More...</a><br /></td></tr>
<tr class="separator:a55b91b451132ca79e049b8ec6f88dc42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9021013483deaf897d26ff6161882ec4"><td class="memItemLeft" align="right" valign="top"><a id="a9021013483deaf897d26ff6161882ec4"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#a9021013483deaf897d26ff6161882ec4">solve_TDHFcore_matrix</a> (const <a class="el" href="classWavefunction.html">Wavefunction</a> &amp;wf, const double omega, const int max_its=25)</td></tr>
<tr class="memdesc:a9021013483deaf897d26ff6161882ec4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Uses itterative matrix method; for tests only. <br /></td></tr>
<tr class="separator:a9021013483deaf897d26ff6161882ec4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1525a4f14874a1c80841ef232687eb3c"><td class="memItemLeft" align="right" valign="top"><a id="a1525a4f14874a1c80841ef232687eb3c"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#a1525a4f14874a1c80841ef232687eb3c">get_eps</a> () const</td></tr>
<tr class="memdesc:a1525a4f14874a1c80841ef232687eb3c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns eps (convergance) of last solve_TDHFcore run. <br /></td></tr>
<tr class="separator:a1525a4f14874a1c80841ef232687eb3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade48263430a3964b0d4b4e9a0776cb0e"><td class="memItemLeft" align="right" valign="top"><a id="ade48263430a3964b0d4b4e9a0776cb0e"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#ade48263430a3964b0d4b4e9a0776cb0e">get_omega</a> () const</td></tr>
<tr class="memdesc:ade48263430a3964b0d4b4e9a0776cb0e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns omega (frequency) of last solve_TDHFcore run. <br /></td></tr>
<tr class="separator:ade48263430a3964b0d4b4e9a0776cb0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac28fee0585a2bff46bc368e2fd957609"><td class="memItemLeft" align="right" valign="top"><a id="ac28fee0585a2bff46bc368e2fd957609"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#ac28fee0585a2bff46bc368e2fd957609">clear_dPsi</a> ()</td></tr>
<tr class="memdesc:ac28fee0585a2bff46bc368e2fd957609"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clears the dPsi orbitals (sets to zero) <br /></td></tr>
<tr class="separator:ac28fee0585a2bff46bc368e2fd957609"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a579011a6ee22b55f44fe12c620a8129c"><td class="memItemLeft" align="right" valign="top"><a id="a579011a6ee22b55f44fe12c620a8129c"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#a579011a6ee22b55f44fe12c620a8129c">dV</a> (const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &amp;Fa, const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &amp;Fb, bool conj, const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> *const Fexcl=nullptr) const</td></tr>
<tr class="memdesc:a579011a6ee22b55f44fe12c620a8129c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate reduced matrix element &lt;a||dV||b&gt; or &lt;a||dV*||b&gt;. Will exclude orbital 'Fexcl' from sum over core (for tests only) <br /></td></tr>
<tr class="separator:a579011a6ee22b55f44fe12c620a8129c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a542086e61a3c3a578b349504b28e4888"><td class="memItemLeft" align="right" valign="top"><a id="a542086e61a3c3a578b349504b28e4888"></a>
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#a542086e61a3c3a578b349504b28e4888">dV</a> (const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &amp;Fa, const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &amp;Fb) const</td></tr>
<tr class="memdesc:a542086e61a3c3a578b349504b28e4888"><td class="mdescLeft">&#160;</td><td class="mdescRight">As above, but automatically determines if 'conjugate' version reuired (Based on sign of [en_a-en_b]) <br /></td></tr>
<tr class="separator:a542086e61a3c3a578b349504b28e4888"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90db050335d2d5b5a8f9c859ada6f0f1"><td class="memItemLeft" align="right" valign="top"><a id="a90db050335d2d5b5a8f9c859ada6f0f1"></a>
<a class="el" href="classDiracSpinor.html">DiracSpinor</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#a90db050335d2d5b5a8f9c859ada6f0f1">dV_rhs</a> (const int kappa_n, const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &amp;Fm, bool conj=false, const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> *const Fexcl=nullptr) const</td></tr>
<tr class="memdesc:a90db050335d2d5b5a8f9c859ada6f0f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns "reduced partial matrix element RHS": dV||Fb}. Note: Fa * dV_rhs(..) equiv to dV(..) <br /></td></tr>
<tr class="separator:a90db050335d2d5b5a8f9c859ada6f0f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aceb56836171e1dd07708c099d2bb3d7c"><td class="memItemLeft" align="right" valign="top"><a id="aceb56836171e1dd07708c099d2bb3d7c"></a>
const std::vector&lt; <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#aceb56836171e1dd07708c099d2bb3d7c">get_dPsis</a> (const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &amp;Fc, dPsiType XorY) const</td></tr>
<tr class="memdesc:aceb56836171e1dd07708c099d2bb3d7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns const ref to dPsi orbitals for given core orbital Fc. <br /></td></tr>
<tr class="separator:aceb56836171e1dd07708c099d2bb3d7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaaf0b61e6c8d69a215941c57a5b96c91"><td class="memItemLeft" align="right" valign="top"><a id="aaaf0b61e6c8d69a215941c57a5b96c91"></a>
const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#aaaf0b61e6c8d69a215941c57a5b96c91">get_dPsi_x</a> (const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &amp;Fc, dPsiType XorY, const int kappa_x) const</td></tr>
<tr class="memdesc:aaaf0b61e6c8d69a215941c57a5b96c91"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns const reference to dPsi orbital of given kappa. <br /></td></tr>
<tr class="separator:aaaf0b61e6c8d69a215941c57a5b96c91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbf14727c5c2b83e5d0402893ed3b628"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classDiracSpinor.html">DiracSpinor</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#adbf14727c5c2b83e5d0402893ed3b628">solve_dPsi</a> (const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &amp;Fv, const double omega, dPsiType XorY, const int kappa_beta, const <a class="el" href="classMBPT_1_1CorrelationPotential.html">MBPT::CorrelationPotential</a> *const Sigma=nullptr) const</td></tr>
<tr class="memdesc:adbf14727c5c2b83e5d0402893ed3b628"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forms  Psi_v for valence state Fv (including core pol.) - 1 kappa.  <a href="#adbf14727c5c2b83e5d0402893ed3b628">More...</a><br /></td></tr>
<tr class="separator:adbf14727c5c2b83e5d0402893ed3b628"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9e38444bd04f00c1d90365f8f6091c7"><td class="memItemLeft" align="right" valign="top"><a id="af9e38444bd04f00c1d90365f8f6091c7"></a>
std::vector&lt; <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#af9e38444bd04f00c1d90365f8f6091c7">solve_dPsis</a> (const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &amp;Fv, const double omega, dPsiType XorY, const <a class="el" href="classMBPT_1_1CorrelationPotential.html">MBPT::CorrelationPotential</a> *const Sigma=nullptr) const</td></tr>
<tr class="memdesc:af9e38444bd04f00c1d90365f8f6091c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forms  Psi_v for valence state Fv for all kappas (see solve_dPsi) <br /></td></tr>
<tr class="separator:af9e38444bd04f00c1d90365f8f6091c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade8eb069a969275416080445b4a24662"><td class="memItemLeft" align="right" valign="top"><a id="ade8eb069a969275416080445b4a24662"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHF_1_1ExternalField.html#ade8eb069a969275416080445b4a24662">print</a> (const std::string &amp;ofname=&quot;dPsi.txt&quot;) const</td></tr>
<tr class="memdesc:ade8eb069a969275416080445b4a24662"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes dPsi (f-component) to textfile. <br /></td></tr>
<tr class="separator:ade8eb069a969275416080445b4a24662"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4a17460a12261f422fac1d6b73006d5"><td class="memItemLeft" align="right" valign="top"><a id="ad4a17460a12261f422fac1d6b73006d5"></a>
<a class="el" href="classHF_1_1ExternalField.html">ExternalField</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator=</b> (const <a class="el" href="classHF_1_1ExternalField.html">ExternalField</a> &amp;)=delete</td></tr>
<tr class="separator:ad4a17460a12261f422fac1d6b73006d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ad6cb2b6b7e8b3c334c14f1bb0660dd"><td class="memItemLeft" align="right" valign="top"><a id="a7ad6cb2b6b7e8b3c334c14f1bb0660dd"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>ExternalField</b> (const <a class="el" href="classHF_1_1ExternalField.html">ExternalField</a> &amp;)=default</td></tr>
<tr class="separator:a7ad6cb2b6b7e8b3c334c14f1bb0660dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Uses time-dependent Hartree-Fock method to include core-polarisation (RPA) corrections to matrix elements of some external field operator. </p>
<p>Solves set of TDHF equations </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ (H -\epsilon \pm \omega)\delta\psi_b = -(\delta V + \delta\epsilon_c)\psi_b \]" src="form_28.png"/>
</p>
<p> self consistantly for each electron in the core to determine dV. (See 'Method' document for detailed physics description). There is an option to limit the maximum number of iterations; set to 1 to get the first-order correction (nb: no damping is used for first iteration). </p><dl class="section user"><dt>Construction</dt><dd>Requires a pointer to an operator (h), a const <a class="el" href="namespaceHF.html" title="Functions and classes for Hartree-Fock. ">HF</a> object (const pointer). </dd></dl>
<dl class="section user"><dt>Usage</dt><dd>solve_TDHFcore(omega) solves TDHF eqs for given frequency. Frequency should be positive, but is allowed to be negative (use as a test only, with care). Can be run again with a different frequency, typically does not need to be re-started from scratch. Then, dV(Fa,Fb) returns the correction to the matrix element: <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \langle \phi_a || \delta V || \phi_b \rangle \]" src="form_29.png"/>
</p>
 </dd></dl>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="adbf14727c5c2b83e5d0402893ed3b628"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbf14727c5c2b83e5d0402893ed3b628">&#9670;&nbsp;</a></span>solve_dPsi()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classDiracSpinor.html">DiracSpinor</a> HF::ExternalField::solve_dPsi </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classDiracSpinor.html">DiracSpinor</a> &amp;&#160;</td>
          <td class="paramname"><em>Fv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>omega</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">dPsiType&#160;</td>
          <td class="paramname"><em>XorY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>kappa_beta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMBPT_1_1CorrelationPotential.html">MBPT::CorrelationPotential</a> *const&#160;</td>
          <td class="paramname"><em>Sigma</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Forms  Psi_v for valence state Fv (including core pol.) - 1 kappa. </p>
<p>Solves </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ (H + \Sigma - \epsilon - \omega)X = -(h + \delta V - \delta\epsilon)\psi \]" src="form_55.png"/>
</p>
<p> or </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ (H + \Sigma - \epsilon + \omega)Y = -(h^\dagger + \delta V^\dagger - \delta\epsilon)Psi\]" src="form_56.png"/>
</p>
<p> Returns <img class="formulaInl" alt="$ \chi_\beta $" src="form_32.png"/> for given kappa_beta, where </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ X_{j,m} = (-1)^{j_\beta-m}tjs(j,k,j;-m,0,m)\chi_j \]" src="form_33.png"/>
</p>
 <h2>XorY takes values: HF::dPsiType::X or HF::dPsiType::Y </h2>
<p>Note: for 'Y', returns &lt;Y|, not |Y&gt; &ndash; may be a difference in sign, since this is a "reduced" spinor </p>

</div>
</div>
<a id="a55b91b451132ca79e049b8ec6f88dc42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55b91b451132ca79e049b8ec6f88dc42">&#9670;&nbsp;</a></span>solve_TDHFcore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HF::ExternalField::solve_TDHFcore </td>
          <td>(</td>
          <td class="paramtype">const double&#160;</td>
          <td class="paramname"><em>omega</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>max_its</em> = <code>100</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>print</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Solves TDHF equations self-consistantly for core electrons at frequency omega. </p>
<p>Solves TDHF equations self-consistantly for core electrons at frequency omega. Will iterate up to a maximum of max_its. Set max_its=1 to get first-order correction [note: no dampling is used for first itteration]. If print=true, will write progress to screen </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>HF/<a class="el" href="ExternalField_8hpp_source.html">ExternalField.hpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
